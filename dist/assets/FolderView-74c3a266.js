import{u as gt,r as i,c as dt,H as z,a as K,b as ft,o as mt,d as pt,e as rt,F as J,f as tt,s as Dt,S as It,E as Et,g as ht,j as y,D as xt,h as At,i as _t,k as wt,l as vt,m as Mt}from"./main-68a4363b.js";const yt=G=>{const{items:v,isEditMode:W,onReorder:U,onDragStart:Q,onDragEnd:d,containerRef:R,externalDragItem:h,onDragOut:n,onFolderPlaceholderChange:p}=G,{dragState:a,setDragState:c,placeholderIndex:I,setPlaceholderIndex:u,placeholderRef:$,itemRefs:o,dragRef:x,itemsRef:C,layoutSnapshotRef:k,hasMovedRef:X,thresholdListenerRef:Y,startDragging:g,resetPlaceholderState:S,dragElementRef:A,captureLayoutSnapshot:j,cachedContainerRectRef:T,performHapticFeedback:O}=gt({items:v,isEditMode:W,onDragStart:Q,onDragEnd:d,externalDragItem:h,createInitialState:rt,resetState:K,containerRef:R}),E=i.useMemo(()=>dt(J),[]);i.useEffect(()=>{I!==null&&a.isDragging&&O(z.REORDER)},[I,O,a.isDragging]),i.useEffect(()=>(h&&p&&p(I!==null),()=>{p&&p(!1)}),[h,I,p]);const V=i.useRef(null),L=i.useRef(null),Z=i.useRef(null),q=i.useCallback(t=>{var r;const e=x.current;if(e.isDragging&&e.item){const l=t.clientX-e.offset.x,D=t.clientY-e.offset.y;V.current={x:l,y:D},A.current&&(A.current.style.left=`${l}px`,A.current.style.top=`${D}px`);const M=T.current||((r=R.current)==null?void 0:r.getBoundingClientRect());if(n&&M)if(E.isOutsideContainer?E.isOutsideContainer(t.clientX,t.clientY,M):!1){e.targetAction!=="dragOut"&&(c(P=>({...P,targetAction:"dragOut"})),u(null));return}else e.targetAction==="dragOut"&&c(P=>({...P,targetAction:"reorder"}));const w=E.calculatePlaceholder(t.clientX,t.clientY,k.current,C.current.length,T.current||void 0);u(w)}},[x,C,k,R,c,u,n,E,A,T]),F=i.useCallback(t=>{Z.current=t,L.current===null&&(L.current=requestAnimationFrame(()=>{L.current=null;const e=Z.current;e&&q(e)}))},[q]);i.useEffect(()=>{if(!h)return;k.current.length===0&&v.length>0&&j();let t=null,e=null;const r=l=>{e=l,t===null&&(t=requestAnimationFrame(()=>{if(t=null,e){const D=E.calculatePlaceholder(e.clientX,e.clientY,k.current,v.length,T.current||void 0);u(D)}}))};return window.addEventListener("mousemove",r),()=>{window.removeEventListener("mousemove",r),t!==null&&cancelAnimationFrame(t)}},[h,v.length,u,j,E,T]);const s=i.useCallback(()=>{const t=x.current;if(!t.isAnimatingReturn)return;const e=t.targetActionData;if(e)switch(O(z.DROP),e.type){case"reorder":U(e.newItems);break;case"dragOut":n&&n(e.item,e.mousePosition);break}c(K()),S(),d&&d()},[x,U,n,d,c,S]),f=i.useCallback(()=>{const t=x.current,e=$.current??-1;if(window.removeEventListener("mousemove",F),t.isDragging&&t.item){if(t.targetAction==="dragOut"&&n){const r=V.current||t.currentPosition;n(t.item,r),c(K()),S(),d&&d();return}if(e!==-1&&e!==t.originalIndex){const r=R.current,l=r==null?void 0:r.getBoundingClientRect();if(l&&r){const D=tt,M=J,w=window.getComputedStyle(r),B=parseFloat(w.paddingLeft)||0,P=parseFloat(w.paddingTop)||0,at=e%M,lt=Math.floor(e/M),et=l.left+B+at*D,nt=l.top+P+lt*D,ct=ft(C.current,t.originalIndex,e);c(ut=>({...ut,isDragging:!1,isAnimatingReturn:!0,currentPosition:{x:et,y:nt},targetPosition:{x:et,y:nt},targetActionData:{type:"reorder",newItems:ct}})),mt(A.current,()=>{x.current.isAnimatingReturn&&s()});return}}}c(K()),S(),d&&d()},[x,$,R,n,d,c,S,F,s,C,A]),m=i.useCallback((t,e,r)=>{pt({isEditMode:W,item:e,index:r,event:t,setDragState:c,onDragStart:l=>{O(z.PICKUP),g(l)},handleMouseMove:F,handleMouseUp:f,createDragState:(l,D,M,w,B,P)=>({...rt(),isDragging:!0,item:l,originalIndex:D,currentPosition:{x:w,y:B},startPosition:{x:w,y:B},offset:P,targetAction:"reorder"})},X,Y)},[W,c,g,F,f,X,Y]),_=i.useCallback(t=>{if(I===null)return{x:0,y:0};const e=(a.isDragging||a.isAnimatingReturn)&&a.originalIndex!==-1;return E.calculateTransform(t,I,e?a.originalIndex:h?-1:a.originalIndex,a.isDragging||a.isAnimatingReturn)},[a.isDragging,a.isAnimatingReturn,a.originalIndex,I,h,E]),b=a.targetAction==="dragOut";return{dragState:a,placeholderIndex:I,itemRefs:o,dragElementRef:A,isDraggingOut:b,handleMouseDown:m,getItemTransform:_}},Rt="_backdrop_1os5g_9",Ct="_popupWrapper_1os5g_31",St="_popover_1os5g_53",Ot="_clickAway_1os5g_67",Lt="_grid_1os5g_83",Pt="_container_1os5g_103",kt="_gridItem_1os5g_147",Tt="_isBeingDragged_1os5g_167",H={backdrop:Rt,popupWrapper:Ct,popover:St,clickAway:Ot,grid:Lt,container:Pt,gridItem:kt,isBeingDragged:Tt},N=J,Ft=_t,bt=wt,it=vt,st=tt,ot=tt,Nt=({folder:G,isEditMode:v,onItemClick:W,onItemEdit:U,onItemDelete:Q,onClose:d,onItemsReorder:R,onItemDragOut:h,anchorRect:n,externalDragItem:p,onDragStart:a,onDragEnd:c,onFolderPlaceholderChange:I})=>{const u=i.useRef(null),$=i.useRef(null),{dragState:o,isDraggingOut:x,placeholderIndex:C,itemRefs:k,handleMouseDown:X,dragElementRef:Y}=yt({items:G.items||[],isEditMode:v,onReorder:R,onDragOut:h,containerRef:$,externalDragItem:p,onDragStart:a,onDragEnd:c,onFolderPlaceholderChange:I}),g=G.items||[],S=i.useMemo(()=>{const s={},f=o.originalIndex,m=C,_=(o.isDragging||o.isAnimatingReturn)&&f!==-1;return g.forEach((b,t)=>{let e=t;_&&(t===f?e=-1:t>f&&(e=t-1));let r=e;e!==-1&&m!==null&&e>=m&&(r=e+1),e===-1&&m!==null&&(r=m);const l=r%N,D=Math.floor(r/N),M=l*st,w=D*ot;s[b.id]={x:M,y:w,visualIndex:r}}),s},[g,o.originalIndex,o.isDragging,o.isAnimatingReturn,C,p]),A=p?g.length+1:g.length,j=p?g.length+1:g.length,O=Math.ceil(Math.max(A,1)/N)*ot-it;i.useEffect(()=>{u.current&&Dt(u.current)},[]),i.useEffect(()=>{const s=m=>{const _=m.target;_.closest('[data-dock-container="true"]')||_.closest('[data-modal="true"]')||document.body.classList.contains("is-dragging")||u.current&&!u.current.contains(m.target)&&E()},f=setTimeout(()=>{document.addEventListener("mousedown",s)},100);return()=>{clearTimeout(f),document.removeEventListener("mousedown",s)}},[]);const E=()=>{u.current?Mt(u.current,300,d):d()};if(g.length===0&&!p)return null;const L=(Math.min(g.length,N)*64+Math.max(Math.min(g.length,N)-1,0)*8+16)/2,Z=i.useMemo(()=>({left:`${Math.min(Math.max(Math.round(((n==null?void 0:n.left)??0)+((n==null?void 0:n.width)??0)/2),L),window.innerWidth-L)}px`,top:`${Math.round(((n==null?void 0:n.top)??0)-24)}px`}),[n==null?void 0:n.left,n==null?void 0:n.width,n==null?void 0:n.top,L]),q=i.useMemo(()=>({width:Math.min(j,N)*st-it+16,height:"auto",transition:`width ${It}ms ${Et}`,pointerEvents:o.isAnimatingReturn?"none":"auto"}),[j,o.isAnimatingReturn]),F=i.useMemo(()=>({height:O,width:"100%"}),[O]);return ht.createPortal(y.jsxs(y.Fragment,{children:[y.jsx("div",{className:H.popupWrapper,style:Z,onClick:s=>s.stopPropagation(),children:y.jsx("div",{ref:u,className:`${H.container} ${H.popover}`,"data-folder-view":"true",style:q,children:y.jsx("div",{ref:$,className:H.grid,style:F,children:g.map((s,f)=>{var b;const m=S[s.id]||{x:0,y:0,visualIndex:0},_=(o.isDragging||o.isAnimatingReturn)&&((b=o.item)==null?void 0:b.id)===s.id;return y.jsx("div",{ref:t=>{k.current[f]=t},className:`${H.gridItem} ${_?H.isBeingDragged:""}`,style:{width:Ft,height:bt,transform:`translate3d(${m.x}px, ${m.y}px, 0)`},children:y.jsx(xt,{item:s,isEditMode:v,onClick:()=>W(s),onEdit:t=>U(s,t),onDelete:()=>Q(s),isDragging:_,staggerIndex:f,onMouseDown:t=>X(t,s,f)})},s.id)})})})}),y.jsx(At,{isActive:o.isDragging||o.isAnimatingReturn,item:o.item,position:o.currentPosition,isAnimatingReturn:o.isAnimatingReturn,isEditMode:v,dragElementRef:Y,isDraggingOut:x})]}),document.body)};export{Nt as FolderView};
